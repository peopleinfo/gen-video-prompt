<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>gen-video-prompt GUI</title>
    <link rel="stylesheet" href="css/styles.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
    <script src="https://js.puter.com/v2/"></script>
  </head>
  <body>
    <header>
      <h1>gen-video-prompt GUI</h1>
      <p>Local UI for your MCP server: prompts, tools, and resources.</p>
    </header>

    <main>
      <section class="panel">
        <div class="tabs">
          <div class="tab" id="tab-setup" data-active="true">Setup LLM</div>
          <div class="tab" id="tab-chat" data-active="false">Chat</div>
          <div class="tab" id="tab-prompts" data-active="false">Prompts</div>
          <div class="tab" id="tab-docs" data-active="false">Docs</div>
          <div class="tab" id="tab-tools" data-active="false">Tools</div>
        </div>

        <div class="content" id="view-setup">
          <label for="provider">Fill missing fields</label>
          <select id="provider">
            <option value="none">Template only (no LLM)</option>
            <option value="command" selected>Local CLI</option>
            <option value="ollama">Ollama (HTTP)</option>
            <option value="openai_compatible">OpenAI-compatible API</option>
            <option value="puter">Puter.js (Cloud)</option>
          </select>

          <div id="providerPuter" style="display: none">
            <label for="puterModel">Model</label>
            <input id="puterModel" placeholder="e.g. gemini-3-flash-preview" />
            <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
              Powered by Puter.js. No API key required when running in Puter environment.
            </div>
          </div>

          <div id="providerCommand" style="display: none">
            <label for="commandPreset">CLI</label>
            <select id="commandPreset">
              <option value="codex" selected>Codex CLI</option>
              <option value="gemini">Gemini CLI</option>
              <option value="agent">Cursor Agent</option>
              <option value="custom">Other CLI</option>
            </select>

            <div id="codexModelRow">
              <label for="codexModelPreset">Select model and effort</label>
              <select id="codexModelPreset">
                <option value="">(default)</option>
                <option value="gpt-5.2-codex">gpt-5.2-codex (current)</option>
                <option value="gpt-5.1-codex-max">gpt-5.1-codex-max</option>
                <option value="gpt-5.1-codex-mini">gpt-5.1-codex-mini</option>
                <option value="gpt-5.2">gpt-5.2</option>
                <option value="custom">Custom...</option>
              </select>
              <div id="codexModelCustom" style="display: none">
                <label for="codexModel">Custom model</label>
                <input id="codexModel" placeholder="e.g. gpt-4.1" />
              </div>
              <div style="margin-top: 6px; font-size: 12px; color: var(--muted)">
                Access legacy models with Custom or via config.toml.
              </div>
            </div>

            <div id="codexSessionRow" style="margin-top: 10px">
              <label for="codexSessionMode">Codex session</label>
              <select id="codexSessionMode">
                <option value="new" selected>New topic (stateless)</option>
                <option value="resume_last">Resume last session</option>
              </select>
              <button id="btnCodexNewTopic" type="button" style="margin-top: 6px">New topic</button>
            </div>

            <div id="geminiModelRow" style="margin-top: 10px; display: none">
              <label for="geminiModelPreset">Gemini model</label>
              <select id="geminiModelPreset">
                <option value="">Auto (best for task)</option>
                <option value="gemini-2.5-pro">Pro (gemini-2.5-pro)</option>
                <option value="gemini-2.5-flash">Flash (gemini-2.5-flash)</option>
                <option value="gemini-2.5-flash-lite">Flash-Lite (gemini-2.5-flash-lite)</option>
                <option value="custom">Custom...</option>
              </select>
              <div id="geminiModelCustom" style="display: none">
                <label for="geminiModel">Custom model</label>
                <input id="geminiModel" placeholder="e.g. gemini-2.5-pro" />
              </div>
            </div>

            <div id="commandCustom" style="display: none">
              <label for="cmd">Command</label>
              <input id="cmd" placeholder="e.g. my-llm-cli" />
            </div>
            <!-- <label for="cmdArgs">Args (space-separated)</label>
            <input id="cmdArgs" disabled placeholder="Disabled for security" /> -->
            <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
              Enable by starting GUI with <code>ENABLE_COMMAND_LLM=1</code>.
            </div>
          </div>

          <div id="providerOllama" style="display: none">
            <label for="ollamaBaseUrl">Base URL</label>
            <input id="ollamaBaseUrl" placeholder="http://127.0.0.1:11434" />
            <label for="ollamaModel">Model</label>
            <input id="ollamaModel" placeholder="e.g. llama3.2" />
            <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
              Enable by starting GUI with <code>ENABLE_HTTP_LLM=1</code>.
            </div>
          </div>

          <div id="providerOpenAi" style="display: none">
            <label for="openaiBaseUrl">Base URL</label>
            <input id="openaiBaseUrl" placeholder="https://api.openai.com" />
            <label for="openaiModel">Model</label>
            <input id="openaiModel" placeholder="e.g. gpt-4o-mini" />
            <label for="openaiApiKey">API key</label>
            <div class="input-wrapper">
              <input id="openaiApiKey" type="password" placeholder="sk-..." />
              <button type="button" class="input-icon" id="toggleOpenaiApiKey" title="Toggle visibility">
                <svg id="eyeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
              Enable by starting GUI with <code>ENABLE_HTTP_LLM=1</code>. API key is stored in your browser localStorage.
            </div>
          </div>

          <div style="margin-top: 16px; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: rgba(255, 255, 255, 0.02)">
            <label style="margin-top: 0">Global Settings</label>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 4px">
            <input id="compressImages" type="checkbox" style="width: auto; margin: 0" />
            <label for="compressImages" style="margin: 0; cursor: pointer; color: var(--text)">Compress images when picking (faster upload)</label>
          </div>
          <div id="compressionSettings" style="margin-top: 12px; display: none; flex-direction: column; gap: 8px; padding-left: 26px; border-left: 2px solid var(--accent)">
            <div style="display: flex; justify-content: space-between; align-items: center">
              <label style="margin: 0; font-size: 0.85em; color: var(--text-dim)">Compression Quality</label>
              <span id="qualityValue" style="font-size: 0.85em; font-weight: bold; color: var(--accent)">0.8</span>
            </div>
            <input id="compressionQuality" type="range" min="0.1" max="1.0" step="0.05" value="0.8" style="width: 100%; margin: 0; height: 4px; background: var(--border); border-radius: 2px; appearance: none; cursor: pointer;" />
          </div>
        </div>

          <div class="row" style="margin-top: 16px; align-items: center">
            <div>
              <label for="llmStatus">LLM connection</label>
              <div id="llmStatus" style="font-size: 12px; color: var(--muted)">(not checked)</div>
            </div>
            <div style="display: flex; align-items: flex-end; gap: 8px">
              <button id="btnConnect">Connect</button>
            </div>
          </div>
        </div>

        <div class="content" id="view-chat" style="display: none">
          <label for="chatPrompt">Message</label>
          <textarea id="chatPrompt" placeholder="Ask the LLM a quick question..."></textarea>
          <label for="chatImages">Images (optional)</label>
          <input id="chatImages" type="file" accept="image/*" multiple />
          <div id="chatImagesList" style="margin-top: 6px; font-size: 12px; color: var(--muted)"></div>
          <button id="btnChatSend">Send</button>
          <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
            Response shows in the Output panel. Images are supported for Codex CLI.
          </div>
        </div>

        <div class="content" id="view-prompts" style="display: none">
          <label>Workspaces</label>
          <div id="workspaceTabs" style="display: flex; flex-wrap: wrap; gap: 8px"></div>
          <div style="margin-top: 6px; font-size: 12px; color: var(--muted)">
            Images are not preserved between workspaces.
          </div>

          <label for="promptName">Prompt</label>
          <select id="promptName"></select>

          <label for="story">Story / request</label>
          <textarea id="story" placeholder="Describe what you want..."></textarea>
          <label for="promptImages">Images (optional)</label>
          <input id="promptImages" type="file" accept="image/*" multiple />
          <div id="promptImagesList" style="margin-top: 6px; font-size: 12px; color: var(--muted)"></div>

          <label for="mode">Mode</label>
          <select id="mode">
            <option value="auto" selected>Auto-detect</option>
            <option value="story">Storytelling</option>
            <option value="meme">Meme / Funny / Viral</option>
            <option value="documentary">Documentary</option>
            <option value="history">History</option>
          </select>

          <div class="row">
            <div>
              <label for="duration">Total duration (seconds) *</label>
              <select id="duration" required>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15" selected>15</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="60">1mn</option>
                <option value="120">2mn</option>
                <option value="custom">Custom…</option>
              </select>
              <input id="durationCustom" placeholder="Enter duration" style="display: none; margin-top: 8px" />
            </div>
            <div>
              <label for="partLengthSeconds">Part length (seconds)</label>
              <input id="partLengthSeconds" placeholder="15" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="resolution">Resolution</label>
              <select id="resolution">
                <option value="" selected>(default 1920x1080)</option>
                <option value="1920x1080">1920x1080</option>
                <option value="1280x720">1280x720</option>
                <option value="720x1280">720x1280</option>
                <option value="1792x1024">1792x1024</option>
                <option value="1024x1792">1024x1792</option>
                <option value="custom">Custom…</option>
              </select>
              <input
                id="resolutionCustom"
                placeholder="Enter resolution (e.g. 1920x1080)"
                style="display: none; margin-top: 8px"
              />
            </div>
            <div>
              <label for="aspect">Aspect ratio</label>
              <select id="aspect">
                <option value="">(leave blank)</option>
                <option value="16:9 landscape">16:9 landscape</option>
                <option value="9:16 portrait" selected>9:16 portrait</option>
                <option value="1:1 square">1:1 square</option>
                <option value="custom">Custom…</option>
              </select>
              <input id="aspectCustom" placeholder="Enter aspect ratio" style="display: none; margin-top: 8px" />
            </div>
          </div>

          <label for="style">Style</label>
          <input id="style" placeholder="cinematic realism, 65mm..." />

          <label for="camera">Camera</label>
          <input id="camera" placeholder="lens, framing, movement..." />

          <label for="lighting">Lighting</label>
          <input id="lighting" placeholder="time of day, key light..." />

          <label for="actionBeats">Action beats</label>
          <input id="actionBeats" placeholder="beat 1 → beat 2 → beat 3..." />

          <label for="quality">Quality</label>
          <input id="quality" placeholder="fps, grain, realism..." />

          <label for="audio">Audio</label>
          <input id="audio" placeholder="rain, distant traffic..." />

          <button id="btnGetPrompt">Get template</button>
          <button id="btnGenerate" style="margin-left: 8px">Generate (fill)</button>
          <button id="btnAbort" type="button" style="margin-left: 8px" disabled>Abort</button>
          <div id="status" style="margin-top: 10px; font-size: 12px; color: var(--muted)"></div>
        </div>

        <div class="content" id="view-docs" style="display: none">
          <button id="btnLoadDocs">List documents</button>
          <label for="docUri">Resource URI</label>
          <select id="docUri"></select>
          <button id="btnReadDoc">Read document</button>
          <div style="margin-top: 10px; font-size: 12px; color: var(--muted)">
            Tip: PDFs may be large; the viewer will show the start of the extracted text.
          </div>
        </div>

        <div class="content" id="view-tools" style="display: none">
          <button id="btnLoadTools">List tools</button>
          <label for="toolName">Tool</label>
          <select id="toolName"></select>
          <label for="toolArgs">Arguments (JSON)</label>
          <textarea id="toolArgs" placeholder="{\n  \"id\": \"some-doc.md\"\n}"></textarea>
          <button id="btnCallTool">Call tool</button>
        </div>
      </section>

      <section class="panel">
        <div class="tabs" style="border-bottom: 1px solid var(--border)">
          <div class="tab" id="tab-preview" data-active="true">Preview</div>
          <div class="tab" id="tab-output" data-active="false">Output</div>
          <div class="tab" id="tab-video" data-active="false">Preview Video</div>
        </div>
        <div
          id="outputActions"
          style="display: none; justify-content: flex-end; gap: 8px; padding: 8px 14px; border-bottom: 1px solid var(--border); align-items: center; flex-wrap: wrap"
        >
          <select id="partSelect" style="margin-top: 0; width: auto; min-width: 180px" disabled>
            <option value="">No parts detected</option>
          </select>
          <button id="btnCopyParts" type="button" style="margin-top: 0" disabled>Copy all parts</button>
          <button id="btnCopyOutput" type="button" style="margin-top: 0">Copy output</button>
          <div
            id="partImageInputs"
            style="display: none; gap: 8px; align-items: flex-end; flex-wrap: wrap; width: 100%"
          ></div>
        </div>
        <pre id="outputPreview">(ready)</pre>
        <pre id="output" style="display: none">(ready)</pre>
        <div id="videoPanel" style="display: none; padding: 14px">
          <label for="videoParts">Video parts (in order)</label>
          <input id="videoParts" type="file" accept="video/*" multiple />
          <div id="videoPartsList" style="margin-top: 6px; font-size: 12px; color: var(--muted)"></div>
          <div style="display: flex; align-items: center; gap: 8px; margin-top: 10px; flex-wrap: wrap">
            <button id="btnMergeVideos" type="button">Merge videos</button>
            <button id="btnClearVideos" type="button">Clear</button>
            <div id="videoStatus" style="font-size: 12px; color: var(--muted)"></div>
          </div>
          <div
            id="videoPreviewWrapper"
            style="width: min(360px, 100%); aspect-ratio: 9 / 16; margin-top: 10px; display: none"
          >
            <video id="videoPreview" controls style="width: 100%; height: 100%; object-fit: contain"></video>
          </div>
        </div>
      </section>
    </main>
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
